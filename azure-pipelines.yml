# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  # What branches will trigger a build?
  branches:
    include:
      # Any Pull Request merging into the master branch
      - master

pool:
  vmImage: "windows-2019"

steps:
  - task: DotNetCoreCLI@2
    inputs:
      command: "custom"
      custom: "tool"
      arguments: "install --global Codecov.Tool"
  - task: DockerInstaller@0
    inputs:
      dockerVersion: "17.09.0-ce"
  # Build Tasks
  - pwsh: |
      .\Install-Prerequisites.ps1
    displayName: "Install prerequisites"
  - pwsh: |
      .\Invoke-Tests.ps1
    displayName: "Run tests and coverage"
  - pwsh: |
      codecov -f coverage.json -t $env:CODECOV_TOKEN
    displayName: "Publish code coverage"
    condition: always()
